{"version":3,"sources":["webpack:///./src/page/modules/javascript/axios/index.vue","webpack:///./src/page/modules/javascript/axios/index.vue?d74b","webpack:///./src/page/modules/javascript/axios/index.vue?fc6c","webpack:///./src/resource/uploadOSSApi.js"],"names":["javascript_axios","name","data","isShowPesent","showpesent","filePath","methods","progress","percent","this","reFindFirst","$callApi","api","param","campusid","gradeCode","reFindCount","pageIndex","pageSize","processtype","likename","onFileChange","e","_this","file","target","files","callUploadApi","created","modules_javascript_axios","render","_h","$createElement","_self","_c","_v","staticRenderFns","Component","__webpack_require__","normalizeComponent","ssrContext","__webpack_exports__","localfile","success","fail","arguments","length","undefined","ret","callApi","then","console","log","ossParam","filehashkey","bucket","OSSAccessKeyId","policyvalue","policy","signaturevalue","signature","fileType","fileName","path","forEach","item","replace","RegExp","replaceOSSInvaildSymbol","fileNameIndex","indexOf","list","split","ossParams","key","substring","success_action_status","formatParams","FormData","append","ajax","XMLHttpRequest","upload","onprogress","progressEvent","type","Math","round","loaded","total","onreadystatechange","readyState","status","resXML","responseText","callback","process","xml","xmlDoc","window","DOMParser","parser","parseFromString","getElementsByTagName","childNodes","nodeValue","url","Bucket","code","message","parserXML","open","send","doUploadFileToOss","chars","maxPos","id","i","charAt","floor","random","moment","format","getUuid","processUpoadFile","successCall","failCall","datas","msg","__WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_json_stringify___default"],"mappings":"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","file":"static/js/17.63e113876af5b2f2351c.js","sourcesContent":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport { callUploadApi } from '../../../../resource/uploadOSSApi.js'\nexport default {\n  name: 'axios',\n\n  data() {\n    return {\n      isShowPesent: false,\n      showpesent: '',\n      filePath: ''\n      // uploadButton: 'uploadButton'\n    }\n  },\n\n  methods: {\n    progress(percent) {\n      this.showpesent = percent\n      this.isShowPesent = true\n    },\n    reFindFirst() {\n      this.$callApi({\n        api: 'get_first_data',\n        param: {\n          campusid: 100,\n          gradeCode: 1152\n        }\n        // mock: true\n      })\n    },\n    reFindCount() {\n      this.$callApi({\n        api: 'oa_resource_findResource',\n        param: {\n          campusid: 1615,\n          pageIndex: 1,\n          pageSize: 20,\n          processtype: 1004,\n          likename: ''\n        }\n      })\n    },\n    onFileChange(e) {\n      const file = e.target.files[0]\n      callUploadApi(\n        file,\n        data => {\n          this.filePath = data\n        },\n        this.progress\n      )\n    }\n  },\n  created() {\n    this.reFindCount()\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/page/modules/javascript/axios/index.vue","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',[_vm._v(\"\\n  asdfsdfs\\n  \")])}\nvar staticRenderFns = []\nvar esExports = { render: render, staticRenderFns: staticRenderFns }\nexport default esExports\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/vue-loader/lib/template-compiler?{\"id\":\"data-v-760165c0\",\"hasScoped\":true,\"transformToRequire\":{\"video\":[\"src\",\"poster\"],\"source\":\"src\",\"img\":\"src\",\"image\":\"xlink:href\"},\"buble\":{\"transforms\":{}}}!./node_modules/vux-loader/src/before-template-compiler-loader.js!./node_modules/vux-loader/src/template-loader.js!./node_modules/vue-loader/lib/selector.js?type=template&index=0!./src/page/modules/javascript/axios/index.vue\n// module id = null\n// module chunks = ","function injectStyle (ssrContext) {\n  require(\"!!../../../../../node_modules/extract-text-webpack-plugin/dist/loader.js?{\\\"omit\\\":1,\\\"remove\\\":true}!vue-style-loader!css-loader?{\\\"sourceMap\\\":true}!../../../../../node_modules/vue-loader/lib/style-compiler/index?{\\\"vue\\\":true,\\\"id\\\":\\\"data-v-760165c0\\\",\\\"scoped\\\":true,\\\"hasInlineConfig\\\":false}!sass-loader?{\\\"sourceMap\\\":true}!../../../../../node_modules/vux-loader/src/style-loader.js!../../../../../node_modules/vue-loader/lib/selector?type=styles&index=0!./index.vue\")\n}\nvar normalizeComponent = require(\"!../../../../../node_modules/vue-loader/lib/component-normalizer\")\n/* script */\nexport * from \"!!babel-loader!../../../../../node_modules/vux-loader/src/script-loader.js!../../../../../node_modules/vux-loader/src/script-loader.js!../../../../../node_modules/vue-loader/lib/selector?type=script&index=0!./index.vue\"\nimport __vue_script__ from \"!!babel-loader!../../../../../node_modules/vux-loader/src/script-loader.js!../../../../../node_modules/vue-loader/lib/selector?type=script&index=0!./index.vue\"\n/* template */\nimport __vue_template__ from \"!!../../../../../node_modules/vue-loader/lib/template-compiler/index?{\\\"id\\\":\\\"data-v-760165c0\\\",\\\"hasScoped\\\":true,\\\"transformToRequire\\\":{\\\"video\\\":[\\\"src\\\",\\\"poster\\\"],\\\"source\\\":\\\"src\\\",\\\"img\\\":\\\"src\\\",\\\"image\\\":\\\"xlink:href\\\"},\\\"buble\\\":{\\\"transforms\\\":{}}}!../../../../../node_modules/vux-loader/src/before-template-compiler-loader.js!../../../../../node_modules/vux-loader/src/template-loader.js!../../../../../node_modules/vue-loader/lib/selector?type=template&index=0!./index.vue\"\n/* template functional */\nvar __vue_template_functional__ = false\n/* styles */\nvar __vue_styles__ = injectStyle\n/* scopeId */\nvar __vue_scopeId__ = \"data-v-760165c0\"\n/* moduleIdentifier (server only) */\nvar __vue_module_identifier__ = null\nvar Component = normalizeComponent(\n  __vue_script__,\n  __vue_template__,\n  __vue_template_functional__,\n  __vue_styles__,\n  __vue_scopeId__,\n  __vue_module_identifier__\n)\n\nexport default Component.exports\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/page/modules/javascript/axios/index.vue\n// module id = null\n// module chunks = ","import callApi from './api.js'\r\nimport moment from 'moment'\r\n// 本地文件信息hashkey，成功回调，进度条，失败回调\r\nexport function callUploadApi(localfile, success, progress, fail = ret => {}) {\r\n  // api 是 用户获取 '签名和Policy' 等信息的应用服务器\r\n  callApi({\r\n    api: 'base_config_getOSSPolicyAndSignature',\r\n    param: {}\r\n  }).then(data => {\r\n    console.log(data, '上传的回调')\r\n    processUpoadFile(localfile, data, success, progress, fail)\r\n  })\r\n}\r\n// 处理客服端传输的文件1 文件hashkey 2 直接传输至OSS\r\nfunction processUpoadFile(localfile, ossParam, success, progress, fail) {\r\n  doUploadFileToOss(localfile, ossParam, getUuid(), success, progress, fail)\r\n}\r\n\r\nfunction getUuid() {\r\n  let chars = 'abcdef0123456789'\r\n  let maxPos = chars.length\r\n  let id = ''\r\n  for (let i = 0; i < 3; i++) {\r\n    // 取三位随机数拼接成id\r\n    id += chars.charAt(Math.floor(Math.random() * maxPos))\r\n  }\r\n  // 返回值作为hash值\r\n  return `${moment().format('YYYYMMDDHHmmss')}${id}`\r\n}\r\n// 上传至OSS\r\nfunction doUploadFileToOss(\r\n  localfile,\r\n  ossParam,\r\n  filehashkey,\r\n  success,\r\n  progress,\r\n  fail\r\n) {\r\n  // uploadType image   OR  multiple æ¹éå¤ç\r\n  const bucket = ossParam.bucket\r\n  const OSSAccessKeyId = ossParam.OSSAccessKeyId\r\n  const policyvalue = ossParam.policy\r\n  const signaturevalue = ossParam.signature\r\n  // 默认文件类型为jpg类型\r\n  let fileType = 'jpg'\r\n  // 文件名 如：icon-step2.png\r\n  let fileName = localfile.name\r\n  if (fileName) {\r\n    fileName = replaceOSSInvaildSymbol(fileName)\r\n  }\r\n  const fileNameIndex = fileName.indexOf('.')\r\n  if (fileNameIndex > 0) {\r\n    const list = fileName.split('.')\r\n    fileType = list[list.length - 1]\r\n  }\r\n  const ossParams = {\r\n    // 文件名(不包含'.'及之后的文件类型)拼接上hash，拼接上文件类型  效果如:   icon-step1_20181127143434c73.png 9999\r\n    key:\r\n      fileName.substring(0, fileNameIndex) + '_' + filehashkey + '.' + fileType,\r\n    OSSAccessKeyId: OSSAccessKeyId,\r\n    policy: policyvalue,\r\n    signature: signaturevalue,\r\n    // 201(已创建)请求成功并且服务器创建了新的资源\r\n    success_action_status: '201'\r\n  }\r\n\r\n  // 处理入参 使用FormData对象格式化入参\r\n  const formatParams = new FormData()\r\n  for (let key in ossParams) {\r\n    formatParams.append(key, ossParams[key])\r\n  }\r\n  formatParams.append('file', localfile)\r\n\r\n  const ajax = new XMLHttpRequest()\r\n  // 进度\r\n  ajax.upload.onprogress = function(progressEvent) {\r\n    if (progressEvent.type === 'progress') {\r\n      // 计算进度\r\n      const percent = Math.round(\r\n        (progressEvent.loaded / progressEvent.total) * 100,\r\n        2\r\n      )\r\n      // 执行传入的进度函数\r\n      progress && progress(percent)\r\n    }\r\n  }\r\n  // 上传结果\r\n  ajax.onreadystatechange = function() {\r\n    if (ajax.readyState === 4) {\r\n      // 这里如果成功返回的是 success_action_status设置的值\r\n      if (ajax.status === 201) {\r\n        const resXML = ajax.responseText\r\n        console.log('服务器响应参数:' + resXML)\r\n        let callback = process(success, fail)\r\n        callback(parserXML(resXML))\r\n      } else {\r\n        console.log('上传失败')\r\n      }\r\n    }\r\n  }\r\n  // 创建http请求参数 (提交方式，提交的地址)\r\n  ajax.open('POST', bucket)\r\n  // ajax.setRequestHeader('Content-type', 'multipart/form-data')\r\n  ajax.send(formatParams)\r\n}\r\n// 处理XML转化后的响应参数\r\nconst process = (successCall, failCall) => {\r\n  return datas => {\r\n    try {\r\n      if (datas.code === 200) {\r\n        successCall(datas.url)\r\n      } else {\r\n        if (failCall === undefined) {\r\n        } else {\r\n          failCall(datas.msg)\r\n        }\r\n      }\r\n    } catch (e) {\r\n      console.log(\r\n        'uploadOSSApi 服务器返回结果发生错误=' + JSON.stringify(datas)\r\n      )\r\n      if (failCall !== undefined) {\r\n        failCall({\r\n          code: '505',\r\n          msg: '返回值json解析错误：' + e + ',服务器返回结果：' + datas\r\n        })\r\n      }\r\n    }\r\n  }\r\n}\r\n// 对上传文件的名做安全处理\r\nfunction replaceOSSInvaildSymbol(path) {\r\n  if (typeof path === 'string') {\r\n    // 当文件中包含如下字符时会上传错误，要进行替换。\r\n    ;['s', '+', '(', ')', '（', '）'].forEach(item => {\r\n      path = path.replace(new RegExp(`\\\\${item}`, 'g'), '')\r\n    })\r\n    return path\r\n  }\r\n  return path\r\n}\r\n// 将XML格式转为一个对象\r\nfunction parserXML(xml) {\r\n  let xmlDoc\r\n  if (window.DOMParser) {\r\n    // DOMParser接口提供了将XML或HTML源代码从字符串解析为DOM的功能Document\r\n    const parser = new DOMParser()\r\n    // 使用parser接口将XML解析为指定文本\r\n    xmlDoc = parser.parseFromString(xml, 'text/xml')\r\n  }\r\n  const bucket = xmlDoc.getElementsByTagName('Bucket')[0].childNodes[0]\r\n    .nodeValue\r\n  const location = xmlDoc.getElementsByTagName('Location')[0].childNodes[0]\r\n    .nodeValue\r\n  return {\r\n    url: location,\r\n    Bucket: bucket,\r\n    code: 200,\r\n    message: 'sucess'\r\n  }\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/resource/uploadOSSApi.js"],"sourceRoot":""}